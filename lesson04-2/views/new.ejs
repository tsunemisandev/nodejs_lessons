<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit</title>
</head>

<form>
    <p>Title</p>
    <input type="text" id="title" value="">
    <p>Content</p>
    <textarea id="content" rows="10" cols="50"></textarea>
    <br>
    <button type="button" onclick="insert()">新規投稿</button>
    <div id='message'></div>
</form>

<body>

    <script>
        function insert() {
            const titleTxt = document.getElementById('title');
            const contentTxt = document.getElementById('content');
            const title = titleTxt.value;
            const content = contentTxt.value;
            //Create json
            const post = {
                title,
                content,

            }
            //Create request
            const req = new XMLHttpRequest();
            //Set url
            req.open('POST', '/post/new')
            //Create header
            req.setRequestHeader('Content-type', 'application/json');
            //Send req
            req.send(JSON.stringify(post));
            //Show ok message
            req.onload = () => {
                const message = document.getElementById('message');
                if (req.status == 204) {
                    //Redirect to list page
                    window.location = '/post';
                } else {
                    let msg = '';
                    const errorMsg = JSON.parse(req.response);
                    if (errorMsg.errors) {
                        errorMsg.errors.forEach(error => {
                            let paramName = error.param;
                            if (paramName === 'title') {
                                msg += 'Title:' + error.msg + '<br>'
                            } else if (paramName === 'content') {
                                msg += 'Content:' + error.msg + '<br>'
                            }
                        });
                    } else if (errorMsg.error) {
                        msg += errorMsg.error;
                    }
                    const messageTxt = document.getElementById('message');
                    messageTxt.innerHTML = msg;
                }
            }
        }
    </script>
</body>

</html>